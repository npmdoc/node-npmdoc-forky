<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/brianc/node-forky">forky (v0.3.0)</a>
</h1>
<h4>node-forky ==========</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.forky">module forky</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.forky.forky">
            function <span class="apidocSignatureSpan"></span>forky
            <span class="apidocSignatureSpan">(options, workerCount, cb)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.forky.disconnect">
            function <span class="apidocSignatureSpan">forky.</span>disconnect
            <span class="apidocSignatureSpan">(timeout)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.forky.log">
            function <span class="apidocSignatureSpan">forky.</span>log
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.forky" id="apidoc.module.forky">module forky</a></h1>


    <h2>
        <a href="#apidoc.element.forky.forky" id="apidoc.element.forky.forky">
        function <span class="apidocSignatureSpan"></span>forky
        <span class="apidocSignatureSpan">(options, workerCount, cb)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">forky = function (options, workerCount, cb) {
  var path;
  if (typeof(options) === 'string') {
    // this is here for backwards compatibility to 0.1.2, remove this when we hit 1.0.0
    path = options;
    if(typeof workerCount == 'function') {
      cb = workerCount;
      workerCount = undefined;
    }
  }
  else {
    path = options.path;
    workerCount = options.workers;
    cb = options.callback;

    if (options.enable_logging !== undefined) {
      LOG = options.enable_logging;
    }
    if (options.kill_timeout !== undefined) {
      KILL_TIMEOUT = options.kill_timeout;
    }
  }

  if (undefined === workerCount) {
    workerCount = os.cpus().length;
  }

  cluster.setupMaster({
    exec: path
  });

  forky.log('starting', workerCount, 'workers');
  for(var i = 0; i &lt; workerCount; i++) {
    forkWorker();
  }

  var listeningWorkers = 0;
  cluster.on('listening', function(worker) {
    if(++listeningWorkers == workerCount) {
      cb ? cb(null, cluster) : function(){};
    }
  });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.forky.disconnect" id="apidoc.element.forky.disconnect">
        function <span class="apidocSignatureSpan">forky.</span>disconnect
        <span class="apidocSignatureSpan">(timeout)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">disconnect = function (timeout) {
  if(!cluster.isWorker) {
    throw new Error("You are not a worker");
  }
  var worker = cluster.worker;
  if(worker.state == 'disconnecting') return;
  worker.state = 'disconnecting';
  worker.disconnectTimeout = timeout;
  forky.log('disconnecting worker', worker.id);
  if(timeout) {
    worker.send({action: 'disconnect', timeout: timeout});
  } else {
    worker.send({action: 'disconnect'});
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
  }, 1000);
});

process.on('uncaughtException', function(err) {
  //log the error
  console.error(err);
  //let's tell our master we need to be disconnected
  require('forky').<span class="apidocCodeKeywordSpan">disconnect</span>();
  //in a worker process, this will signal the master that something is wrong
  //the master will immediately spawn a new worker
  //and the master will disconnect our server, allowing all existing traffic to end naturally
  //but not allowing this process to accept any new traffic
});
```
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.forky.log" id="apidoc.element.forky.log">
        function <span class="apidocSignatureSpan">forky.</span>log
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">log = function () {
    if (LOG) {
        console.log.apply(console, arguments);
    }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

var shuttingDown = false;

var KILL_TIMEOUT = 1000;
var LOG = false;

function killTimeout(worker, timeout) {
forky.<span class="apidocCodeKeywordSpan">log</span>('setting kill timeout of', timeout, 'for worker', worker
.id);
var tid = setTimeout(function() {
  forky.log('worker', worker.id, 'did not shutdown after timeout', timeout, 'killing');
  worker.destroy();
}, timeout);
worker.once('exit', function() {
  forky.log('worker', worker.id, 'died. clear kill timeout');
  clearTimeout(tid);
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>